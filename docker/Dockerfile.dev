# 开发环境Dockerfile - 使用阿里云镜像
FROM alibaba-cloud-linux-3-registry.cn-hangzhou.cr.aliyuncs.com/alinux3/python:3.11.1

# 设置工作目录
WORKDIR /app

# 设置环境变量
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1
ENV DEBUG=1

# 安装基础系统依赖（跳过系统更新以避免RPM数据库问题）
RUN yum install -y --setopt=tsflags=nodocs \
        curl \
        git \
    && yum clean all

# 安装uv包管理器
RUN pip install uv

# 复制依赖文件
COPY pyproject.toml .
COPY requirements.txt .

# 安装开发依赖，但不包含需要编译的包
# 注意：这个版本不包含以下功能：
# - RAG系统 (faiss-cpu, sentence-transformers)
# - 云端向量存储 (dashvector)
# - 其他需要编译的Python包
RUN uv pip install -e .[dev]

# 暴露端口
EXPOSE 7860

# 设置默认命令（开发模式）
CMD ["python", "-m", "vertex_flow.cli", "web", "--host", "0.0.0.0", "--port", "7860", "--reload"] 