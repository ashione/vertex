# ============================================================================
# MCP (Model Context Protocol) 配置
# ============================================================================
# MCP提供统一的工具调用接口，支持连接外部MCP服务器和暴露内部工具
# 
# 可用的内置工具列表：
# 1. 命令行工具 (execute_command) - 执行系统命令
# 2. 网络搜索工具 (web_search_*) - 支持多个搜索引擎
#    - web_search_bocha: 博查搜索
#    - web_search_duckduckgo: DuckDuckGo搜索
#    - web_search_serpapi: SerpAPI搜索
#    - web_search_searchapi: SearchAPI搜索
#    - web_search_bing: Bing搜索
# 3. 金融工具 (finance_tool) - 获取股票、汇率等金融数据
# 4. 时间工具:
#    - today: 获取当前日期时间
#    - time_convert: 时间格式转换
#    - time_diff: 计算时间差
# 5. 自定义工具:
#    - calculate: 数学计算器
#    - process_text: 文本处理工具
#
# MCP工具调用格式：
# 在对话中，AI可以自动调用这些工具，例如：
# - "帮我搜索最新的AI新闻" -> 自动调用web_search工具
# - "执行ls命令" -> 自动调用execute_command工具
# - "查询苹果股票价格" -> 自动调用finance_tool工具
# - "现在几点了" -> 自动调用today工具
# - "计算2+2" -> 自动调用calculate工具
#
mcp:
  # Enable MCP integration
  enabled: true
  
  # MCP Clients - Connect to external MCP servers
  clients:
    # Filesystem server for file access
    filesystem:
      enabled: true
      transport: "stdio"
      command: "npx"
      args:
        - "@modelcontextprotocol/server-filesystem"
        - "/path/to/your/workspace"  # 修改为你的工作目录
    
    # Everything server for testing tools
    everything:
      enabled: true
      transport: "stdio"
      command: "npx"
      args:
        - "-y"
        - "@modelcontextprotocol/server-everything"
    
    # Lark MCP client for chat history and document access
    # 使用说明：
    # 1. 在飞书开放平台创建应用获取APP_ID和APP_SECRET
    # 2. 设置环境变量：export LARK_APP_ID=your_app_id
    # 3. 设置环境变量：export LARK_APP_SECRET=your_app_secret
    # 4. 将enabled改为true启用
    # Lark MCP client for chat history and document access
    # 使用说明：
    # 1. 在飞书开放平台创建应用获取APP_ID和APP_SECRET
    # 2. 设置环境变量：export LARK_APP_ID=your_app_id 和 export LARK_APP_SECRET=your_app_secret
    # 3. 将enabled改为true启用
    # 可用功能：聊天记录访问、消息发送、文档内容读取、多维表格搜索
    lark:
      enabled: false  # 默认禁用，需要配置环境变量后手动启用
      transport: "stdio"
      command: "lark-mcp"
      args:
        - "mcp"
        - "-a"
        - "${LARK_APP_ID:-your-lark-app-id}"
        - "-s"
        - "${LARK_APP_SECRET:-your-lark-app-secret}"
        - "--oauth"
        - "-c"
        - "snake"
        - "-t"
        - "im.v1.message.create,im.v1.message.list,im.v1.chat.list,im.v1.chat.create,im.v1.chat.search,im.v1.chatMembers.get,docx.v1.document.rawContent,bitable.v1.appTableRecord.search,docx.builtin.search,contact.v3.user.batchGetId,wiki.v2.space.getNode,wiki.v1.node.search,docx.builtin.import"
      env:
        LARK_APP_ID: "${LARK_APP_ID:-}"
        LARK_APP_SECRET: "${LARK_APP_SECRET:-}"
      description: "Access Lark chat history, messages, documents and Bitable records"
    
    # GitHub MCP client for repository access
    # 使用说明：
    # 1. 在GitHub创建Personal Access Token
    # 2. 设置环境变量：export GITHUB_PERSONAL_ACCESS_TOKEN=your_token
    # 3. 将enabled改为true启用
    # 可用功能：仓库访问、Issue管理、Pull Request操作、文件读写
    github:
      enabled: false
      transport: "stdio"
      command: "npx"
      args: ["@modelcontextprotocol/server-github"]
      env:
        GITHUB_PERSONAL_ACCESS_TOKEN: "${GITHUB_PERSONAL_ACCESS_TOKEN:-your-github-token}"
      description: "Access GitHub repositories and issues"
    
    # Database MCP client for database access
    # 使用说明：
    # 1. 安装数据库MCP服务器：pip install mcp-server-database
    # 2. 修改connection-string为你的数据库连接字符串
    # 3. 将enabled改为true启用
    # 支持：SQLite、MySQL、PostgreSQL等数据库
    database:
      enabled: false
      transport: "stdio"
      command: "python"
      args: ["-m", "mcp_server_database", "--connection-string", "sqlite:///your_database.db"]
      description: "Access database resources"
    
    # Web Search MCP client (独立于内置搜索)
    # 使用说明：
    # 1. 安装搜索MCP服务器：pip install mcp-server-web-search
    # 2. 设置环境变量：export SEARCH_API_KEY=your_api_key
    # 3. 将enabled改为true启用
    # 提供额外的网络搜索能力，补充内置搜索功能
    mcp_web_search:
      enabled: false
      transport: "stdio"
      command: "python"
      args: ["-m", "mcp_server_web_search"]
      env:
        SEARCH_API_KEY: "${SEARCH_API_KEY:-your-search-api-key}"
      description: "MCP-based web search capabilities"
    
    # HTTP MCP client for远程MCP服务器连接
    # 使用说明：
    # 1. 确保远程MCP服务器正在运行
    # 2. 修改base_url为实际的服务器地址
    # 3. 将enabled改为true启用
    # 用于连接通过HTTP协议提供的MCP服务
    http_server:
      enabled: false
      transport: "http"
      base_url: "http://localhost:8080"
      description: "Connect to HTTP MCP server"
  
  # MCP Server - 暴露Vertex Flow资源和工具给外部MCP客户端
  # 使用说明：
  # 1. 启用后可以将Vertex Flow作为MCP服务器供其他应用使用
  # 2. stdio传输适用于命令行集成
  # 3. HTTP传输适用于Web应用集成
  # 4. 可以选择性暴露工作流、文档、配置等资源
  server:
    enabled: true
    name: "VertexFlow"
    version: "1.0.0"
    
    # Server transport configuration
    transport:
      # stdio transport (for command-line usage)
      stdio:
        enabled: true
      
      # HTTP transport (for web-based usage)
      http:
        enabled: false
        host: "localhost"
        port: 8080
    
    # Resources to expose
    resources:
      enabled: true
      # Expose workflow configurations
      workflows:
        enabled: true
        path: "vertex_flow/workflow"
        pattern: "*.py"
      
      # Expose documentation
      docs:
        enabled: true
        path: "docs"
        pattern: "*.md"
      
      # Expose configuration files
      configs:
        enabled: true
        path: "vertex_flow/config"
        pattern: "*.yml"
    
    # Tools to expose - 暴露给外部MCP客户端的工具
    tools:
      enabled: true
      
      # Expose function tools - 暴露功能工具
      # 包含所有内置工具：命令行、网络搜索、金融、时间、计算等
      function_tools:
        enabled: true
        # Auto-discover function tools - 自动发现所有可用工具
        auto_discover: true
        # Specific function tools to expose - 指定要暴露的工具
        # 可用工具列表：
        # - execute_command: 命令行执行
        # - web_search_*: 各种搜索引擎
        # - finance_tool: 金融数据查询
        # - today: 当前时间
        # - time_convert: 时间转换
        # - time_diff: 时间差计算
        # - calculate: 数学计算
        # - process_text: 文本处理
        include:
          - "web_search"
          - "command_line"
          - "finance"
          - "today"
          - "calculate"
      
      # Expose workflow execution - 暴露工作流执行能力
      workflow_execution:
        enabled: true
        description: "Execute Vertex Flow workflows"
      
      # Expose vertex operations - 暴露顶点操作能力
      vertex_operations:
        enabled: true
        description: "Perform vertex-level operations"
    
    # Prompts to expose
    prompts:
      enabled: true
      
      # System prompts
      system_prompts:
        enabled: true
        path: "vertex_flow/prompts/system"
      
      # Task-specific prompts
      task_prompts:
        enabled: true
        path: "vertex_flow/prompts/tasks"
      
      # Custom prompts
      custom_prompts:
        - name: "code_review"
          template: |
            Please review the following code and provide feedback:
            
            Code:
            {code}
            
            Focus areas: {focus_areas}
            
            Please provide:
            1. Overall assessment
            2. Potential issues
            3. Improvement suggestions
            4. Best practices recommendations
          description: "Code review prompt with focus areas"
          arguments:
            - name: "code"
              description: "Code to review"
              required: true
            - name: "focus_areas"
              description: "Specific areas to focus on (security, performance, etc.)"
              required: false
        
        - name: "workflow_design"
          template: |
            Design a Vertex Flow workflow for the following requirements:
            
            Requirements:
            {requirements}
            
            Constraints:
            {constraints}
            
            Please provide:
            1. Workflow structure
            2. Vertex configuration
            3. Data flow design
            4. Error handling strategy
          description: "Workflow design assistance"
          arguments:
            - name: "requirements"
              description: "Workflow requirements"
              required: true
            - name: "constraints"
              description: "Technical or business constraints"
              required: false

# ============================================================================
# MCP集成设置 (MCP Integration Settings)
# ============================================================================
integration:
  # Auto-connect to MCP clients on startup
  auto_connect: true
  
  # Timeout for MCP operations (seconds)
  timeout: 30
  
  # Retry configuration
  retry:
    max_attempts: 3
    delay: 1.0
    backoff_factor: 2.0
  
  # Logging configuration
  logging:
    level: "INFO"
    log_mcp_messages: false
    log_tool_calls: true
  
  # Security settings
  security:
    # Require explicit approval for tool calls
    require_approval: false
    
    # Allowed resource patterns
    allowed_resources:
      - "file://*"
      - "workflow://*"
      - "config://*"
    
    # Blocked resource patterns
    blocked_resources:
      - "file:///etc/*"
      - "file:///root/*"
    
    # Tool execution limits
    tool_limits:
      max_execution_time: 60  # seconds
      max_memory_usage: 100   # MB
