# Vertex Flow 统一配置模板
# 集成了LLM、MCP、向量存储、网络搜索等所有功能的配置
# 通过docker env可以注入相关的配置，作为修改值
# 例如llm.deepseek.sk，则通过llm_deepseek_sk环境变量
# 在docker启动时设置-e llm_deepseek_sk=?
#
# 本地模型支持（Ollama）:
# 1. 安装Ollama: https://ollama.com/download
# 2. 启动服务: ollama serve
# 3. 拉取模型: ollama pull qwen:7b
# 4. 在应用中切换到ollama提供商

# ============================================================================
# 大语言模型配置 (LLM Configuration)
# ============================================================================
llm:
  deepseek:
    sk: ${llm.deepseek.sk:-YOUR_DEEPSEEK_API_KEY}
    enabled: false
    models:
      - name: deepseek-chat
        enabled: true
      - name: deepseek-coder
        enabled: false
  tongyi:
    sk: ${llm.tongyi.sk:-YOUR_TONGYI_API_KEY}
    enabled: false
    models:
      - name: qwen-max
        enabled: true
      - name: qwen-plus
        enabled: false
      - name: qwen-turbo
        enabled: false
  openrouter:
    sk: ${llm.openrouter.sk:-YOUR_OPENROUTER_API_KEY}
    enabled: false
    models:
      - name: deepseek/deepseek-chat-v3-0324:free
        enabled: false
      - name: deepseek/deepseek-r1-0528:free
        enabled: false
      - name: google/gemini-2.5-pro
        enabled: true
      - name: anthropic/claude-3.5-sonnet
        enabled: false
      - name: openai/gpt-4o
        enabled: false
  ollama:
    sk: ${llm.ollama.sk:-ollama-local}          # 本地模型不需要真实API key，使用占位符
    enabled: false                               # 默认不启用，需要手动切换
    base-url: ${llm.ollama.base_url:-http://localhost:11434}  # Ollama服务地址
    models:
      - name: qwen:7b
        enabled: true
      - name: llama3:8b
        enabled: false
      - name: mistral:7b
        enabled: false

web-search:
  # Bocha AI搜索服务 - 高质量AI总结，支持日期过滤
  bocha:
    sk: ${web-search.bocha.sk:-YOUR_BOCHA_API_KEY}
    enabled: false  # 需要API密钥，提供最佳搜索体验
  
  # DuckDuckGo搜索服务 - 免费即时答案，无需API密钥
  duckduckgo:
    enabled: true  # 默认启用，作为免费备选方案
  
  # SerpAPI搜索服务 - Google搜索结果，免费层每月100次
  serpapi:
    api_key: ${web-search.serpapi.api_key:-YOUR_SERPAPI_API_KEY}
    enabled: false  # 需要API密钥，提供Google搜索结果
  
  # SearchAPI.io搜索服务 - 多搜索引擎支持，免费层每月100次
  searchapi:
    api_key: ${web-search.searchapi.api_key:-YOUR_SEARCHAPI_API_KEY}
    enabled: false  # 需要API密钥，支持多种搜索引擎
  
  # 注意：以上搜索服务按优先级排序，系统会自动选择第一个启用且配置正确的服务
  # 建议配置：启用Bocha AI（付费，最佳体验）+ DuckDuckGo（免费备选）
  
  # 已废弃的配置（保留以兼容旧版本）
  bing:
    sk: ${web-search.bing.sk:-YOUR_BING_API_KEY}
    enabled: false

# 金融工具配置
finance:
  alpha-vantage:
    api-key: ${finance.alpha-vantage.api-key:-YOUR_ALPHA_VANTAGE_API_KEY}
    enabled: false
  finnhub:
    api-key: ${finance.finnhub.api-key:-YOUR_FINNHUB_API_KEY}
    enabled: false
  yahoo-finance:
    enabled: true

workflow:
  dify:
    root-path: config/
    instances:
    - name: if_else_test
      path: if-else-test.yml

web:
  port: 8999
  host: 0.0.0.0
  workers: 8

# 向量存储配置（支持本地和云端）
vector:
  # 本地向量存储配置
  local:
    enabled: true  # 默认启用本地向量存储
    dimension: 384  # 向量维度
    index_name: "default"  # 索引名称
    persist_dir: null  # 持久化目录，null表示使用默认目录 (~/.vertex_flow/vector_db)
  
  # DashVector云端配置
  dashvector:
    enabled: false  # 默认不启用云端
    api-key: ${vector.dashvector.api_key:-YOUR_DASHVECTOR_API_KEY}
    endpoint: ${vector.dashvector.endpoint:-YOUR_DASHVECTOR_ENDPOINT}
    cluster: ${vector.dashvector.cluster:-vertex-vector}
    collection: ${vector.dashvector.collection:-YOUR_COLLECTION_NAME}
    image-collection: ${vector.dashvector.image_collection:-YOUR_IMAGE_COLLECTION_NAME}

# 嵌入模型配置（支持本地和云端）
embedding:
  # 本地嵌入模型配置
  local:
    enabled: true  # 默认启用本地嵌入
    model_name: "all-MiniLM-L6-v2"  # 本地嵌入模型名称
    dimension: 384  # 向量维度
    use_mirror: true  # 是否使用国内镜像源（默认true）
    mirror_url: "https://hf-mirror.com"  # 镜像源URL
  
  # DashScope云端配置
  dashscope:
    enabled: false  # 默认不启用云端
    endpoint: ${embedding.dashscope.endpoint:-default}
    api-key: ${embedding.dashscope.api_key:-YOUR_DASHSCOPE_API_KEY}
    model-name: ${embedding.dashscope.model_name:-text-embedding-v1}
  
  # BCE云端配置
  bce:
    enabled: false  # 默认不启用云端
    api-key: ${embedding.bce.api_key:-YOUR_BCE_API_KEY}
    endpoint: ${embedding.bce.endpoint:-https://api.siliconflow.cn/v1/embeddings}
    model-name: ${embedding.bce.model_name:-netease-youdao/bce-embedding-base_v1}

# 重排序配置
rerank:
  # 本地重排序配置
  local:
    enabled: false  # 默认不启用本地重排序
    method: "keyword"  # 重排序方法：keyword, semantic
  
  # BCE云端重排序配置
  bce:
    enabled: false  # 默认不启用云端重排序
    api-key: ${rerank.bce.api_key:-YOUR_BCE_RERANK_API_KEY}
    endpoint: ${rerank.bce.endpoint:-https://api.siliconflow.cn/v1/rerank}
    model-name: ${rerank.bce.model_name:-netease-youdao/bce-reranker-base_v1}

# 文档处理配置
document:
  chunk_size: 1000  # 文档分块大小
  chunk_overlap: 200  # 分块重叠大小
  supported_formats: ["txt", "md", "pdf", "docx"]  # 支持的文档格式

# 检索配置
retrieval:
  top_k: 3  # 检索的文档数量
  similarity_threshold: 0.7  # 相似度阈值
  rerank: false  # 是否启用重排序

# ============================================================================
# MCP (Model Context Protocol) 配置
# ============================================================================
mcp:
  # Enable MCP integration
  enabled: true
  
  # MCP Clients - Connect to external MCP servers
  clients:
    # Filesystem server for file access
    filesystem:
      enabled: true
      transport: "stdio"
      command: "npx"
      args:
        - "@modelcontextprotocol/server-filesystem"
        - "/Users/wjf/workspaces"
    
    # Everything server for testing tools
    everything:
      enabled: true
      transport: "stdio"
      command: "npx"
      args:
        - "-y"
        - "@modelcontextprotocol/server-everything"
    
    # Example GitHub MCP client  
    github:
      enabled: false
      transport: "stdio"
      command: "npx"
      args: ["@modelcontextprotocol/server-github"]
      env:
        GITHUB_PERSONAL_ACCESS_TOKEN: "your-github-token"
      description: "Access GitHub repositories and issues"
    
    # Example database MCP client
    database:
      enabled: false
      transport: "stdio"
      command: "python"
      args: ["-m", "mcp_server_database", "--connection-string", "sqlite:///example.db"]
      description: "Access database resources"
    
    # Example web search MCP client (different from built-in web search)
    mcp_web_search:
      enabled: false
      transport: "stdio"
      command: "python"
      args: ["-m", "mcp_server_web_search"]
      env:
        SEARCH_API_KEY: "your-search-api-key"
      description: "MCP-based web search capabilities"
    
    # Example HTTP MCP client
    http_server:
      enabled: false
      transport: "http"
      base_url: "http://localhost:8080"
      description: "Connect to HTTP MCP server"
  
  # MCP Server - Expose Vertex Flow resources and tools
  server:
    enabled: true
    name: "VertexFlow"
    version: "1.0.0"
    
    # Server transport configuration
    transport:
      # stdio transport (for command-line usage)
      stdio:
        enabled: true
      
      # HTTP transport (for web-based usage)
      http:
        enabled: false
        host: "localhost"
        port: 8080
    
    # Resources to expose
    resources:
      enabled: true
      # Expose workflow configurations
      workflows:
        enabled: true
        path: "vertex_flow/workflow"
        pattern: "*.py"
      
      # Expose documentation
      docs:
        enabled: true
        path: "docs"
        pattern: "*.md"
      
      # Expose configuration files
      configs:
        enabled: true
        path: "vertex_flow/config"
        pattern: "*.yml"
    
    # Tools to expose
    tools:
      enabled: true
      
      # Expose function tools
      function_tools:
        enabled: true
        # Auto-discover function tools
        auto_discover: true
        # Specific function tools to expose
        include:
          - "web_search"
          - "command_line"
          - "finance"
      
      # Expose workflow execution
      workflow_execution:
        enabled: true
        description: "Execute Vertex Flow workflows"
      
      # Expose vertex operations
      vertex_operations:
        enabled: true
        description: "Perform vertex-level operations"
    
    # Prompts to expose
    prompts:
      enabled: true
      
      # System prompts
      system_prompts:
        enabled: true
        path: "vertex_flow/prompts/system"
      
      # Task-specific prompts
      task_prompts:
        enabled: true
        path: "vertex_flow/prompts/tasks"
      
      # Custom prompts
      custom_prompts:
        - name: "code_review"
          template: |
            Please review the following code and provide feedback:
            
            Code:
            {code}
            
            Focus areas: {focus_areas}
            
            Please provide:
            1. Overall assessment
            2. Potential issues
            3. Improvement suggestions
            4. Best practices recommendations
          description: "Code review prompt with focus areas"
          arguments:
            - name: "code"
              description: "Code to review"
              required: true
            - name: "focus_areas"
              description: "Specific areas to focus on (security, performance, etc.)"
              required: false
        
        - name: "workflow_design"
          template: |
            Design a Vertex Flow workflow for the following requirements:
            
            Requirements:
            {requirements}
            
            Constraints:
            {constraints}
            
            Please provide:
            1. Workflow structure
            2. Vertex configuration
            3. Data flow design
            4. Error handling strategy
          description: "Workflow design assistance"
          arguments:
            - name: "requirements"
              description: "Workflow requirements"
              required: true
            - name: "constraints"
              description: "Technical or business constraints"
              required: false

# ============================================================================
# MCP集成设置 (MCP Integration Settings)
# ============================================================================
integration:
  # Auto-connect to MCP clients on startup
  auto_connect: true
  
  # Timeout for MCP operations (seconds)
  timeout: 30
  
  # Retry configuration
  retry:
    max_attempts: 3
    delay: 1.0
    backoff_factor: 2.0
  
  # Logging configuration
  logging:
    level: "INFO"
    log_mcp_messages: false
    log_tool_calls: true
  
  # Security settings
  security:
    # Require explicit approval for tool calls
    require_approval: false
    
    # Allowed resource patterns
    allowed_resources:
      - "file://*"
      - "workflow://*"
      - "config://*"
    
    # Blocked resource patterns
    blocked_resources:
      - "file:///etc/*"
      - "file:///root/*"
    
    # Tool execution limits
    tool_limits:
      max_execution_time: 60  # seconds
      max_memory_usage: 100   # MB