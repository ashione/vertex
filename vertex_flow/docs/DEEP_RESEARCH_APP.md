# Deep Research Gradio 应用使用指南

## 🔬 概述

Deep Research Gradio 应用是一个基于 Vertex Flow 深度研究工作流的交互式 Web 应用。它提供了友好的图形用户界面，让用户可以轻松进行复杂主题的深度研究分析。

## ✨ 功能特点

### 🎯 核心功能
- **六阶段研究流程**：主题分析 → 研究规划 → 信息收集 → 深度分析 → 交叉验证 → 总结报告
- **实时进度显示**：流式模式下可实时查看研究进展
- **阶段历史回顾**：可随时查看已完成阶段的详细内容
- **智能内容格式化**：自动检测和渲染Markdown格式内容
- **智能报告生成**：自动生成专业的深度研究报告
- **多模型支持**：支持切换不同的 LLM 模型
- **文件保存功能**：可选择保存中间结果和最终报告

### 🛠️ 技术特点
- **流式处理**：支持实时流式输出，提升用户体验
- **错误处理**：完善的异常处理和错误提示
- **配置灵活**：支持自定义配置文件和参数
- **界面友好**：现代化的 Gradio 界面设计

## 🚀 快速开始

### 1. 环境准备

确保已安装必要的依赖：
```bash
uv install gradio
# 或者
pip install gradio
```

### 2. 配置 LLM

编辑配置文件 `vertex_flow/config/llm.yml`：
```yaml
llm:
  openai:
    enabled: true
    model-name: "gpt-4"
    api-key: "your-openai-api-key"
  deepseek:
    enabled: true  
    model-name: "deepseek-chat"
    api-key: "your-deepseek-api-key"
```

### 3. 启动应用

#### 方式一：使用CLI命令（推荐）
```bash
# 基本启动Web界面
vertex deepresearch
# 或简写
vertex dr

# 使用环境变量指定配置文件
export CONFIG_FILE=config/llm.yml.backup
vertex deepresearch

# 指定端口
vertex deepresearch --port 8080

# 创建公共链接
vertex deepresearch --share

# 使用自定义配置文件
vertex deepresearch --config my_config.yml

# 命令行模式直接研究（无需启动Web界面）
vertex dr --topic "人工智能发展趋势"

# 批量模式（非流式输出）
vertex dr --topic "区块链应用" --batch

# 开发模式（详细日志）
vertex dr --dev
```

#### 方式二：直接运行模块
```bash
# 从项目根目录运行
python -m vertex_flow.src.deep_research_app

# 或者直接运行文件
python vertex_flow/src/deep_research_app.py --port 7861
```

### 4. 访问应用

启动成功后，访问显示的地址（默认：http://127.0.0.1:7861）

## 📱 界面使用指南

### 主界面布局

```
┌─────────────────────────────────────────────────────────────┐
│                    Deep Research 应用标题                    │
├───────────────────────────────┬─────────────────────────────┤
│           研究配置区           │         模型配置区           │
│  ┌─────────────────────────┐  │  ┌─────────────────────────┐ │
│  │     研究主题输入框       │  │  │     当前模型显示        │ │
│  └─────────────────────────┘  │  └─────────────────────────┘ │
│  ┌─┬─┬─┐ ┌─────┬──────────┐  │  ┌─────────────────────────┐ │
│  │保│保│流│ │开始│ 查看状态 │  │  │    可用模型列表         │ │
│  │存│存│式│ │研究│          │  │  └─────────────────────────┘ │
│  │中│最│模│ └─────┴──────────┘  │  ┌─────────────────────────┐ │
│  │间│终│式│                    │  │    模型切换区           │ │
│  └─┴─┴─┘                      │  └─────────────────────────┘ │
│                               │                             │
│           执行状态区           │                             │
│  ┌─────────────────────────┐  │                             │
│  │     当前状态显示        │  │                             │
│  └─────────────────────────┘  │                             │
│  ┌─────────────────────────┐  │                             │
│  │     当前阶段显示        │  │                             │
│  └─────────────────────────┘  │                             │
│  ┌─────────────────────────┐  │                             │
│  │     进度日志区          │  │                             │
│  └─────────────────────────┘  │                             │
├───────────────────────────────┴─────────────────────────────┤
│                      研究报告显示区                          │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                                                         │ │
│  │                 深度研究报告内容                         │ │
│  │                                                         │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 操作步骤

#### 1. 配置研究参数
- **研究主题**：输入您想要深度研究的主题
- **保存设置**：
  - ✅ 保存中间文档：保存每个阶段的分析结果
  - ✅ 保存最终报告：将最终报告保存为文件
  - ✅ 流式模式：实时显示分析进度（推荐）

#### 2. 开始研究
- 点击 "🚀 开始深度研究" 按钮
- 系统将按照六个阶段依次执行分析
- 在流式模式下可实时查看进度

#### 3. 查看结果
- **执行状态区**：显示当前执行状态和进度
- **阶段历史区**：查看已完成的研究阶段列表
- **阶段详情区**：点击特定阶段查看详细分析内容
- **研究报告区**：显示最终生成的深度研究报告
- **格式切换**：在Markdown渲染和原始文本间切换显示
- **文件保存**：如果启用了保存功能，报告将保存到本地文件

#### 4. 模型管理
- **查看当前模型**：右侧显示当前使用的 LLM 模型
- **切换模型**：输入提供商名称（如 `deepseek`、`openai`）来切换模型
- **模型状态**：查看所有配置的模型状态

### 💡 使用技巧

#### 阶段历史回顾功能
1. **实时阶段跟踪**：运行过程中，左侧"阶段历史"会实时更新已完成的阶段
2. **点击查看详情**：选择任意已完成的阶段，点击"查看阶段详情"按钮
3. **详细内容展示**：右侧会显示该阶段的完整分析内容，包括：
   - 阶段名称和完成时间
   - 内容长度统计
   - 完整的分析结果

#### 内容格式优化
- **自动Markdown检测**：系统智能识别内容中的Markdown格式
- **双模式显示**：可在"Markdown渲染"和"原始文本"间切换
- **样式优化**：标题、列表、代码块等自动美化渲染

#### 研究效率提升
- **流式模式推荐**：建议开启流式模式查看实时进度
- **中间结果保存**：启用中间文档保存可回顾分析过程
- **阶段内容对比**：可同时查看不同阶段内容进行对比分析

## 📋 研究主题示例

### 科技类主题
```
人工智能在医疗领域的应用与发展趋势
区块链技术在金融科技中的创新应用
量子计算技术的发展现状与未来展望
可持续能源技术的发展趋势
5G技术对物联网发展的推动作用
```

### 商业类主题
```
新零售模式的发展趋势与挑战
远程办公对企业管理模式的影响
数字化转型在传统制造业的应用
共享经济模式的可持续发展研究
电商直播对消费行为的影响分析
```

### 社会类主题
```
老龄化社会的挑战与应对策略
数字鸿沟对社会公平的影响
在线教育的发展趋势与质量保障
城市化进程中的环境保护问题
社交媒体对青少年心理健康的影响
```

## ⚙️ 配置说明

### 应用配置

启动参数：
- `--host`：服务器主机地址（默认：127.0.0.1）
- `--port`：服务器端口号（默认：7861）
- `--share`：创建公共 Gradio 链接
- `--config`：指定 LLM 配置文件路径

### LLM 配置

支持的提供商：
- **OpenAI**：GPT-3.5, GPT-4 系列
- **DeepSeek**：DeepSeek Chat 模型
- **Ollama**：本地部署的开源模型
- **Anthropic**：Claude 系列（需要配置）

配置示例：
```yaml
llm:
  deepseek:
    enabled: true
    model-name: "deepseek-chat"
    api-key: "sk-xxx"
    base-url: "https://api.deepseek.com"
    
  openai:
    enabled: false
    model-name: "gpt-4"
    api-key: "sk-xxx"
    
  ollama:
    enabled: true
    model-name: "llama2"
    base-url: "http://localhost:11434"
```

### 研究配置

工作流参数：
- `save_intermediate`：是否保存中间阶段结果
- `save_final_report`：是否保存最终报告文件
- `enable_stream`：是否启用流式模式
- `research_topic`：研究主题内容

## 🔧 故障排除

### 常见问题

#### 1. 启动失败
```
❌ 启动失败: 无法获取聊天模型
```
**解决方案**：
- 检查配置文件 `vertex_flow/config/llm.yml` 是否存在
- 确认至少有一个 LLM 提供商的 `enabled: true`
- 验证 API 密钥是否正确配置

#### 2. 模型切换失败
```
❌ 切换失败: 无法找到指定的提供商
```
**解决方案**：
- 检查提供商名称是否正确（区分大小写）
- 确认目标提供商在配置文件中已启用
- 验证对应的 API 密钥和配置是否正确

#### 3. 研究执行失败
```
❌ 研究执行失败: 工作流创建失败
```
**解决方案**：
- 检查研究主题是否为空
- 确认当前模型可用且配置正确
- 查看日志文件获取详细错误信息

#### 4. 网络连接问题
```
❌ API 调用失败: 网络连接超时
```
**解决方案**：
- 检查网络连接是否正常
- 验证 API 服务是否可访问
- 考虑使用代理或更换 API 端点

### 调试模式

启用调试模式获取更多信息：
```bash
vertex deepresearch --dev
```

查看详细日志：
```bash
tail -f logs/vertex_flow.log
```

## 📂 文件结构

```
vertex_flow/
├── cli.py                            # CLI入口（包含deep research启动）
├── src/
│   └── deep_research_app.py          # 主应用文件
├── workflow/app/
│   ├── deep_research_workflow.py     # 工作流实现
│   ├── test_deep_research.py         # 测试脚本
│   └── README_DEEP_RESEARCH.md       # 工作流文档
├── docs/
│   └── DEEP_RESEARCH_APP.md          # 本文档
└── config/
    └── llm.yml                       # LLM 配置文件
```

## 🤝 技术支持

### 获取帮助

1. **查看文档**：
   - 工作流文档：`vertex_flow/workflow/app/README_DEEP_RESEARCH.md`
   - 配置文档：`vertex_flow/docs/`

2. **运行测试**：
   ```bash
   python vertex_flow/workflow/app/test_deep_research.py
   ```

3. **检查日志**：
   ```bash
   # 查看应用日志
   tail -f logs/vertex_flow.log
   
   # 查看研究结果文件
   ls -la research_reports/
   ```

### 开发和定制

- **修改界面**：编辑 `vertex_flow/src/deep_research_app.py` 中的 `create_gradio_interface` 函数
- **调整工作流**：修改 `vertex_flow/workflow/app/deep_research_workflow.py`
- **添加功能**：在 `DeepResearchApp` 类中添加新方法

## 📝 更新日志

### v1.0.0
- ✅ 初始版本发布
- ✅ 支持六阶段深度研究工作流
- ✅ Gradio Web 界面
- ✅ 流式进度显示
- ✅ 多模型支持
- ✅ 文件保存功能
- ✅ 启动脚本和文档

---

🔬 **Deep Research - 让深度研究变得简单高效！** 